/*
 * Content handler
 */

var md = require('marked')

var tutos = {
              granjaSpawner: {
                                titulo: "Granja con Spawner"
                                ,sinopsis: "Construye una granja de experiencia y loots con un Spawner de mazmorra evitando morir en el intento"
                                ,tutorial: "Convertir un spawner en una granja de experiencia\n===================\n\n*Realizado por Miki_Lopez  ---  Versión 1.0 [25/07/2013]*\n\nCon este manual aprenderás a fabricar una granja que te permitirá obtener rápidamente experiencia, además de otros materiales y subir en el ranking de muertes del servidor.\n\n# Spawners #\n\nEste manual se centra en el uso y aprovechamiento de un **spawner**, o mejor dicho, **mazmorra** (*dungeon* en inglés). Estas mazmorras aparecen por todo el mapa, bajo tierra, y consisten en una pequeña habitación de dimensiones ligeramente variables, con paredes de roca, suelo de roca musgosa, algún cofre y en el centro, un bloque de spawner.\n\n![Imagen](/content/images/granjaSpawner/spawner.png 'Un spawner de arañas')\n\n## Reglas de spawneo ##\n\nEl bloque central hará aparecer algún tipo de mob hostil (araña, zombie o esqueleto), siempre que se cumplan estas condiciones:\n\n* Haya un jugador a una distancia de 16 bloques o menos.\n* El nivel de iluminación permita la aparición de mobs.\n\nLas mazmorras se saltan ciertas normas sobre la aparición de mobs:\n\n* No puede aparecer un mob que no sea el del bloque.\n* Los mobs pueden aparecer sobre losas o agua.\n\n## Frecuencia de spawneo ##\nLa frecuencia de aparición es aleatoria, ajustada dentro de un rango.\n\n* Siempre que sea posible, spawnearán entre 1 y 4 mobs simultáneamente.\n* Una vez spawneen, no volverá a spawnear nada hasta pasados entre 10 y 40 segundos.\n\n## Área de spawneo ##\nEl área en la que se puede spawnear se describe así:\n\n* El centro está en la esquina inferior orientada al noroeste.\n* Desde esa esquina, pueden aparecer en 4 bloques al norte y al sur (si hay espacio).\n* Desde esa esquina, pueden aparecer en 4 bloques al este y al oeste (si hay espacio).\n* Desde esa esquina, pueden aparecer en 1 bloque arriba o abajo (si hay suelo).\n\n# Preparando la trampa #\n\n## Materiales necesarios ##\n\nEsta es una lista de los materiales esenciales para la creación de la trampa:\n\n* Pico\n* Antorchas\n* Dos cubos de agua\n* Bloque de construcción favorito (roca, ladrillo...)\n\n## Acomodando el área ##\n\nUna vez localizado un spawner, lo primero que se ha de hacer es **iluminarlo**, para así evitar la aparición de mobs mientras se está trabajando en él. Se recomienda colocar una antorcha en cada lado de bloque, una encima, y una centrada en cada pared, dos bloques por encima del bloque de spawn.\nAsí mismo, resulta buena idea **sellar** la cámara para evitar la entrada de mobs no deseados.\n\n## Suelo adecuado ##\n\nSe localizará la esquina central del spawner, y a partir de ahí se contarán 4 bloques en cada dirección (norte, sur, este, oeste). En caso de encontrar pared, picar hasta conseguir un suelo de 8x8. Si la pared va más allá de este tamaño, hacer una pared nueva para ajustarlo al tamaño.\n\n## Empuje con agua ##\n\nElegir una pared al azar, y cavar un zanja en el suelo de 2 bloques de profundidad. En la pared opuesta, picar la fila baja de la pared, y llenarla entera de agua. Para ello, colocar un cubo en el lado izquierdo (bloque 1), y el otro cubo en el bloque 3. Automáticamente el bloque 2 se rellenará de agua, por lo que se podrá llenar el cubo y completar el bloque 5, haciendo que el 4 se rellene de agua. Repetir sucesivamente hasta completar los 8 bloques.\n\n**Cuidado**: el agua te empujará hacia la zanja y retirará las antorchas laterales del bloque de spawn. Las antorchas caerán a la zanja.\n\n![Imagen](/content/images/granjaSpawner/sala_lista.png 'Habitación lista')\n\n## Salvoconducto ##\n\nPreparar un conducto de salida de la sala, romper todas las antorchas, salir lo antes posible (pues spawnearán monstruos) y volver a sellar la sala.\n\n# Recogida de experiencia #\n\nLa parte principal de la trampa ya está lista. Ahora mientras haya un jugador a menos de 16 bloques de distancia del bloque de spawn, la zanja se irá llenando de mobs. Para matar los mobs y así conseguir experiencia, material y muertes, se puede preparar la zanja de diversas formas.\n\n## Golpear a los pies ##\n\nLa forma más sencilla de matar a los mobs, es picar un pasillo paralelo a la zanja, un bloque más bajo, para así poder golpear a los mobs sin que ellos puedan golpearte a ti. Mientras los golpeas, seguirán apareciendo más debido a la cercanía del bloque de spawn.\n\n![Imagen](/content/images/granjaSpawner/tobillos.png 'Golpeando a los pies')\n\nEste método tiene la desventaja de que los mobs tienen la vida al completo, y por tanto tardan en morir y gastan espada. Por eso existen alternativas.\n\n## Caída ##\n\nSimplemente cambiando la altura de la zanja de 2 bloques a 21-22, la caída hace tanto daño a los mobs que con uno o dos golpes con el puño pueden morir. Esto hace más rápido y fácil obtener la experiencia. Por contrapartida el bloque de spawn queda tan lejos que mientras se esté matando mobs no aparecerán nuevos, por lo que hay que permanecer un tiempo arriba y, tras acumular varios mobs, bajar y matarlos.\n\n## Concentración ##\n\nHay quien encuentra que moverse a lo largo de los 8 bloques de la zanja le resulta no del todo óptimo, así que se puede mejorar de la siguiente manera: en la zanja original, se coloca un bloque de agua en un extremo. Al otro extremo, se hace otra zanja de 1 bloque de ancho. Así todos los mobs se acumulan en un solo bloque, lo que facilita su muerte. Además, esta zanja puede ser igualmente de 22 bloques de profundidad, para poder matar los mobs de un solo golpe.\n\n![Imagen](/content/images/granjaSpawner/1bloque.png 'Los mobs se acumularán en un solo bloque')\n\n![Imagen](/content/images/granjaSpawner/1bloqueb.png 'Docenas de esqueletos en muy poco espacio')\n\n# Recomendaciones #\n\nTener en cuenta las siguientes recomendaciones:\n\n* No intentar granjear experiencia con spawners de arañas, ya que hace falta una zanja el doble de ancha, la cual pueden volver a escalar, y como son menos altas, no funciona lo de darles en los tobillos (se escapan y sálvese quien pueda).\n* Al fondo de la zanja se pueden colocar losas, y bajo estas, tolvas, y así poder recoger automáticamente todo lo que suelten los mobs y llevarlo a un cofre.\n* No dejar aparecer mobs durante más de dos horas, puede ocasionar problemas tanto en el servidor como en el cliente.\n* No se puede encantar nada por encima del nivel 30, ni reparar nada por encima del 40, y cada nivel cuesta más de conseguir, así que no es provechoso almacenar más experiencia que la de conseguir el nivel 40.\n"
                                ,imagesFolder: "granjaSpawner"
                                ,author: "Miki_Lopez"
                                ,submissionDate: ""
                              },
              primerosPasos: {
                                titulo: "Primeros pasos"
                                ,sinopsis: "Guía basica de inicio en el servidor, aprende a configurar tu Minecarft y lo que debes hacer la primera vez que te conectes"
                                ,tutorial: "Cómo jugar en el servidor\n======================\n\n*Realizado por Miki_Lopez  ---  Versión 1.0 [02/09/2013]*\n\nSi eres nueva/o en el servidor, se recomienda leer este tutorial para saber cómo funciona el servidor. Aquí se explica cómo empezar a jugar en él y qué cosas tiene de especial, para que las disfrutes todas.\n\n# Primeros pasos #\n\nLa única forma de entrar en el servidor es mediante invitación. La forma más directa es que se te invite y te presentes en el grupo de Facebook.\n\n`https://www.facebook.com/groups/539129696145682`\n\nAsí se habilitará tu nombre de usuario en el servidor. Es importante leerse las normas, que están en la página web.\n\n`http://kajuryto.com/normas`\n\nUna vez hecho todo, ya podrás entrar, tan solo has de añadir la dirección IP del servidor a tu lista de servidores, desde `Multijugador` > `Añadir servidor`\n\n![Imagen](/content/images/primerosPasos/anadir_server.png 'Añadiendo nuevo servidor a la lista')\n\n## Instalando el juego ##\n\nSi por alguna razón no tienes este maravilloso juego todavía en tu ordenador, o tienes una versión anterior a la 1.6, instalarlo es muy sencillo, tan solo has de descargarte el Launcher, está disponible en la los archivos del grupo de Facebook\n\n![Imagen](/content/images/primerosPasos/descargar.png 'Archivo a descargar')\n\nEs un archivo de Java válido para Windows, Linux y Mac. Una vez abierto te sale esta ventana, en la cual en `Username` tendremos que poner nuestro usuario, y darle al botón `Play`\n\n![Imagen](/content/images/primerosPasos/launcher1.png 'Iniciando sesión en el juego')\n\nUna vez hecho, la ventana cambiará ligeramente, y donde estaba el botón `Play` ahora tendremos un `Play offline`. A partir de ahora, cada vez que se abra el juego, nos aparecerá ese botón y podremos iniciar el juego. La primera vez tardará un poco porque descargá archivos del juego, como texturas y sonidos.\nUna vez iniciado el juego, hay que añadir el servidor a la lista, como se ha indicado más arriba, y ya se podrá jugar.\n\n# Registro e inicio de sesión en el servidor #\n\nLa primera vez que te conectes al servidor, te pedirá que te registres con una contraseña. Para ello, pulsa la tecla `T` para abrir el chat, y escribe la siguiente línea y pulsa `Enter`\n\n`/register contraseña`\n\n![Imagen](/content/images/primerosPasos/registro.png 'Registrándose con la contraseña secreto1234')\n\nA partir de ahí, cada vez que entremos en el servidor, tendremos que iniciar sesión abriendo el chat y escribiendo\n\n`/login contraseña`\n\n![Imagen](/content/images/primerosPasos/inicio.png 'Iniciando sesión')\n\nEs importante saber que mientras no se inicie sesión es imposible moverse, interactuar con el terreno ni ver nada más allá de unos pocos bloques. Igualmente mientras no se inicie sesión, nada puede afectar al jugador.\n\nSi se desea cambiar la contraseña, solo has de utilizar el comando `changepass pass_vieja pass_nueva`\n\n`/changepass secreto1234 nueva1234`\n\n![Imagen](/content/images/primerosPasos/cambio.png 'Cambiando la contraseña')\n\n# Tu zona de residencia en el servidor #\n\nEl servidor está diseñado para que inicialmente aparezcas en una zona al azar en el mapa. Si no te gusta te moverás hasta encontrar un sitio que te agrade. Es muy importante, una vez encontrada esta zona, asignar tu hogar a ese sitio. De hecho, se recomiendo hacer esto nada más registrarse en el servidor. Para hacerlo, solo hay que ejecutar este comando.\n\n`/sethome`\n\n¿Por qué es **importante** hacer esto? Porque si mueres, o si te pierdes, puedes volver fácilmente a tu casa. Para volver, sólo tienes que usar este otro comando\n\n`/home`\n\nTen en cuenta que este último sólo puedes usarlo una vez cada hora (60 minutos), así que lleva cuidado.\n\nSiempre que quieras, puedes cambiar tu hogar a donde tú quieras. Es decir, si decides construir una segunda casa en otro sitio, puedes hacer `/sethome` en ese nuevo sitio.\n\n## La sala del Limbo ##\n\nSi en algún momento murieras, reaparecerás en la Sala del Limbo. Es una sala de la cual es imposible salir, excepto teletrasportándose. Por ello es importante haber hecho `/sethome`, para así poder volver a casa con `/home`. En el caso de no haber asignado el hogar previamente, contacta con el adminstrador para que solucione el problema, pero ten en cuenta que si la situación se repite, podrías ser baneado del servidor.\n\n![Imagen](/content/images/primerosPasos/limbo.png 'Así es el Limbo')\n\n## Otras formas de localización ##\nPara saber dónde está tu casa, puedes crear un **mapa en el juego**. Solo has de rodear una brújula con papel en la mesa de trabajo, y para ampliar el mapa, rodearlo de más papel (hasta 5 veces).\n\nTambién puedes usar el **mapa del servidor**. Se accede a través de la dirección `http://maps.kajuryto.com` y haciendo clic en tu nombre de usuario (panel de la derecha, se despliega al acercar el ratón), cuadra el mapa en tu posición. Puedes añadir marcadores para señalizar tus construcciones o cosas interesantes que encuentres, ¡pero sin abusar!\n\nPara añadir un nuevo marcador, sitúate en la posición del mapa donde quieres que aparezca y escribre\n\n`/dmarker add 'Texto del marcador'`\n\nImportante no olvidar las comillas. Para eliminar un marcador es exactamente igual, y puedes hacerlo desde cualquier parte del mapa, solo cambia 'add' por 'delete'\n\n`/dmarker delete 'Texto del marcador'`\n\n![Imagen](/content/images/primerosPasos/mapa.png 'Jugador tutorio cerca de su casa')\n\nPor último, puedes utilizar la **información de depuración** del juego, pulsando la tecla `F3`, ahí aparece mucha información, entre ella, tus coordenadas espaciales dentro del mapa, que corresponden con el bloque que está bajo tus pies. La coordenada X indica tu posición este-oeste, mientras que la Z indica tu posición norte-sur. La Y representa la altura del suelo, lo cual no suele ser útil para localización. Anota tus coordenadas X,Z y así podrás volver a tu casa de forma fácil. Cuidado, estas coordenadas tienen muchos decimales, no hace falta que los anotes.\n\n# El contador de muertes #\n\nEn las últimas versiones de Minecraft, pulsando la tecla `Tabulación` es posible ver los demás jugadores conectados así como su velocidad de conexión (con un indicador verde). En el servidor, además, se puede ver un valor numérico. Este es el **contador de muertes**, e indica a cuántos enemigos, jugadores o animales ha matado el jugador. Este contador no se reinicia si mueres.\n\nMás allá de un mero ranking, el contador de muertes tiene una utilidad especial. En las coordenadas (0,0), el centro del mapa, se encuentra una torre, la **Torre de la Muerte**, la cual tiene una serie de pedestales en los que un jugador puede colocarse, y puede canjear sus muertes por premios. Hay pedestales para cambiar por 1000, 2000, 5000 y 10000 muertes, haciendo un total de **ocho pedestales**. Los premios son un secreto y un regalo del FSM, así que no se sabe mucho de ellos.\n\nPor ejemplo, un jugador con 2026 muertes en su haber, podría cambiarlas por un premio de 2000 muertes, o por dos de 1000 muertes, quedando su contador a 26 tras recibir el premio."
                                ,imagesFolder: "primerosPasos"
                                ,author: "Miki_Lopez"
                                ,submissionDate: null
                              }
            };



function ContentHandler(){
  
  this.spawn = function(req, res, next){
    return res.render('spawn');
  };

  this.servidor = function(req, res, next){
    return res.render('servidor');
  };

  this.normas = function(req, res, next){
    return res.render('normas');
  };

  this.tutoriales = function(req, res, next){
    return res.render('tutoriales');
  };

  this.displayTutoriales = function(req, res, next){
    var name = req.params.tutorial;
    var tutorial = tutos[name];

    if(tutorial == undefined){
      return res.render('tutorial', { titulo: 'TUTORIALES',
                                      md: md,
                                      tutorial: '## El tutorial que buscas no existe'
                                    })
    };

    var titulo = tutorial.titulo;
    var sinopsis = tutorial.sinopsis;
    var content = tutorial.tutorial;

    return res.render('tutorial', { titulo: titulo, 
                                    sinopsis: sinopsis, 
                                    md: md, 
                                    tutorial: content
                                  });

  };


  // 404 handler
  this.notFound = function(req, res, next){
    return res.send(404, '404'); //res.render('404'));
  };

}

module.exports = ContentHandler;